"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const factory_1 = __importDefault(require("../factory"));
const leaf_1 = __importDefault(require("../nodes/leaf"));
exports.default = () => ({
    Blank: [
        {
            dependsOn: ['In'],
            forTypes: ['String'],
            replacer: leaf => leaf.override({ operator: 'In', value: [null, ''] }),
        },
        {
            dependsOn: ['Missing'],
            replacer: leaf => leaf.override({ operator: 'Missing' }),
        },
    ],
    Missing: [
        {
            dependsOn: ['Equal'],
            replacer: leaf => leaf.override({ operator: 'Equal', value: null }),
        },
    ],
    Present: [
        {
            dependsOn: ['NotIn'],
            forTypes: ['String'],
            replacer: leaf => leaf.override({ operator: 'NotIn', value: [null, ''] }),
        },
        {
            dependsOn: ['NotEqual'],
            replacer: leaf => leaf.override({ operator: 'NotEqual', value: null }),
        },
    ],
    Equal: [
        {
            dependsOn: ['In'],
            replacer: leaf => leaf.override({ operator: 'In', value: [leaf.value] }),
        },
    ],
    In: [
        {
            dependsOn: ['Equal', 'Match'],
            forTypes: ['String'],
            replacer: leaf => {
                const values = leaf.value;
                const conditions = [];
                for (const value of [null, '']) {
                    if (values.includes(value)) {
                        conditions.push(new leaf_1.default(leaf.field, 'Equal', value));
                    }
                }
                if (values.some(v => v !== null && v !== '')) {
                    const escaped = values.filter(Boolean).map(str => str.replace(/[.|[\]]/g, m => `\\${m}`));
                    const regexp = new RegExp(`^${escaped.join('|')}$`, 'g');
                    conditions.push(new leaf_1.default(leaf.field, 'Match', regexp));
                }
                return factory_1.default.union(...conditions);
            },
        },
        {
            dependsOn: ['Equal'],
            replacer: leaf => factory_1.default.union(...leaf.value.map(item => leaf.override({ operator: 'Equal', value: item }))),
        },
    ],
    NotEqual: [
        {
            dependsOn: ['NotIn'],
            replacer: leaf => leaf.override({ operator: 'NotIn', value: [leaf.value] }),
        },
    ],
    NotIn: [
        {
            dependsOn: ['NotEqual', 'Match'],
            forTypes: ['String'],
            replacer: leaf => {
                const values = leaf.value;
                const conditions = [];
                for (const value of [null, '']) {
                    if (values.includes(value)) {
                        conditions.push(new leaf_1.default(leaf.field, 'NotEqual', value));
                    }
                }
                if (values.some(v => v !== null && v !== '')) {
                    const escaped = values.filter(Boolean).map(str => str.replace(/[.|[\]]/g, m => `\\${m}`));
                    const regexp = new RegExp(`(?!${escaped.join('|')})`, 'g');
                    conditions.push(new leaf_1.default(leaf.field, 'Match', regexp));
                }
                return factory_1.default.intersect(...conditions);
            },
        },
        {
            dependsOn: ['NotEqual'],
            replacer: leaf => factory_1.default.intersect(...leaf.value.map(item => leaf.override({ operator: 'NotEqual', value: item }))),
        },
    ],
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcGFyaXNvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9pbnRlcmZhY2VzL3F1ZXJ5L2NvbmRpdGlvbi10cmVlL3RyYW5zZm9ybXMvY29tcGFyaXNvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLHlEQUE4QztBQUU5Qyx5REFBOEM7QUFHOUMsa0JBQWUsR0FBNkMsRUFBRSxDQUFDLENBQUM7SUFDOUQsS0FBSyxFQUFFO1FBQ0w7WUFDRSxTQUFTLEVBQUUsQ0FBQyxJQUFJLENBQUM7WUFDakIsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDO1lBQ3BCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDO1NBQ3ZFO1FBQ0Q7WUFDRSxTQUFTLEVBQUUsQ0FBQyxTQUFTLENBQUM7WUFDdEIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsQ0FBQztTQUN6RDtLQUNGO0lBQ0QsT0FBTyxFQUFFO1FBQ1A7WUFDRSxTQUFTLEVBQUUsQ0FBQyxPQUFPLENBQUM7WUFDcEIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDO1NBQ3BFO0tBQ0Y7SUFDRCxPQUFPLEVBQUU7UUFDUDtZQUNFLFNBQVMsRUFBRSxDQUFDLE9BQU8sQ0FBQztZQUNwQixRQUFRLEVBQUUsQ0FBQyxRQUFRLENBQUM7WUFDcEIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLFFBQVEsRUFBRSxPQUFP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